generator client {
  provider = "prisma-client"
  output   = "../src/main/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model User {
  id       String @id @default(uuid())
  username String @unique
  password String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id          String  @id @default(uuid())
  name        String
  code        String? @unique
  description String?

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products Product[]
}

model Brand {
  id          String  @id @default(uuid())
  name        String
  code        String? @unique
  description String?
  logo        String?

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products Product[]
}

enum ProductStatus {
  ACTIVE
  INACTIVE
}
TODO: complete this schema add tags and other fields
model Product {
  id    String  @id @default(uuid())
  name  String
  sku   String  @unique
  image String?

  status ProductStatus

  categoryId String?
  category   Category? @relation(fields: [categoryId], references: [id])

  brandId String?
  brand   Brand?  @relation(fields: [brandId], references: [id])

  baseGlobalUomId String?
  baseGlobalUom   GlobalUom? @relation(fields: [baseGlobalUomId], references: [id])

  minStockLevel Int?
  maxStockLevel Int?

  trackInventory Boolean @default(true)

  productUoms ProductUom[]

  batches    Batch[]
  stockMoves StockMove[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum UomDimension {
  WEIGHT_STD
}

model GlobalUom {
  id        String @id @default(uuid())
  name      String
  code      String @unique
  dimension String

  factorToBase Decimal
  precision    Int     @default(0)

  rootUomId String?
  rootUom   GlobalUom?  @relation("UomHierarchy", fields: [rootUomId], references: [id])
  children  GlobalUom[] @relation("UomHierarchy")

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products Product[]
  uoms     Uom[]

  @@index([dimension])
  @@index([rootUomId])
}

model Uom {
  id   String  @id @default(uuid())
  name String
  code String? @unique

  globalBaseUomId String
  globalBaseUom   GlobalUom @relation(fields: [globalBaseUomId], references: [id])

  defaultConversionFactor Decimal

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  productUoms ProductUom[]
  batches     Batch[]
}

model ProductUom {
  id String @id @default(uuid())

  productId String
  product   Product @relation(fields: [productId], references: [id])

  uomId String
  uom   Uom    @relation(fields: [uomId], references: [id])

  conversionFactor Decimal

  salePrice     Decimal?
  purchasePrice Decimal?
  discountRate  Decimal  @default(0)
  barcode       String?  @unique

  isDefaultSalesUom    Boolean @default(false)
  isDefaultPurchaseUom Boolean @default(false)

  isActive   Boolean     @default(true)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  stockMoves StockMove[]

  @@unique([productId, uomId])
}

model Batch {
  id String @id @default(uuid())

  productId String
  product   Product @relation(fields: [productId], references: [id])

  code String

  costPrice      Decimal
  referenceUomId String
  uom            Uom     @relation(fields: [referenceUomId], references: [id])

  expiryDate DateTime?

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  stockMoves StockMove[]

  @@unique([productId, code])
}

enum StockMoveType {
  PURCHASE
  SALE
  SALE_RETURN
  PURCHASE_RETURN
  ADJUSTMENT
  TRANSFER
  OPENING
}

model StockMove {
  id String @id @default(uuid())

  productId String
  product   Product @relation(fields: [productId], references: [id])

  productUomId String?
  productUom   ProductUom? @relation(fields: [productUomId], references: [id])

  batchId String?
  batch   Batch?  @relation(fields: [batchId], references: [id])

  type StockMoveType

  quantityBase Int

  reference String?
  note      String?

  createdAt DateTime @default(now())

  @@index([productId])
  @@index([batchId])
}
